@model WebApplication2.Models.PlcVariablesViewModel

@{
    ViewData["Title"] = "Home";
}

<h1>@ViewData["Title"]</h1>


<h2>Wartości z PLC</h2>

<p>MyBoolVariable: <span id="my-bool-variable-display">@Model.MyBoolVariable</span></p>
<p>iCounter: <span id="i-counter-display">@Model.iCounter</span></p>
<p>sTekst: <span id="s-tekst-display">@Model.sTekst</span></p>
<p>iTemperature: <span id="i-temperature-display">@Model.iTemperature</span></p>
<p>iPressure: <span id="i-pressure-display">@Model.iPressure</span></p>
<p>MomentarySwitch: <span id="momentary-switch-display">@Model.MomentarySwitch</span></p>
<p>ToggleSwitch: <span id="toggle-switch-display">@Model.ToggleSwitch</span></p>

<h2>Zapis danych do PLC</h2>

<input type="checkbox" id="my-bool-variable">
<label for="my-bool-variable">MyBoolVariable</label>
<br>

<input type="number" id="i-counter" value="0">
<label for="i-counter">iCounter</label>
<br>

<input type="text" id="s-tekst">
<label for="s-tekst">sTekst</label>
<br>

<input type="number" id="i-temperature" value="0">
<label for="i-temperature">iTemperature</label>
<br>

<input type="number" id="i-pressure" value="0">
<label for="i-pressure">iPressure</label>
<br>

<input type="checkbox" id="momentary-switch">
<label for="momentary-switch">MomentarySwitch</label>
<br>

<input type="checkbox" id="toggle-switch">
<label for="toggle-switch">ToggleSwitch</label>
<br>

<button id="toggle-bool-button">Zmień MyBoolVariable</button>



<div id="error-message" style="display:none; color:red;"></div>

@section Scripts {

    <script>
        async function refresh() {
            const request = await fetch('/json');
            const data = await request.json();

            console.log('Nasze dane', data);
            document.getElementById('i-counter-display').textContent = data.iCounter;
            document.getElementById('my-bool-variable-display').textContent = data.MyBoolVariable;
        }

        setInterval(refresh, 2000);

        document.getElementById('toggle-bool-button').addEventListener('click', async () => {
            try {
                const response = await fetch('/toggleBool', { // Nowy endpoint /toggleBool
                    method: 'POST', // Ważne: używamy POST
                    headers: {
                        'Content-Type': 'application/json' // Informujemy serwer, że wysyłamy JSON
                    },
                    body: JSON.stringify({}) // Wysyłamy puste ciało - serwer sam odczyta i zmieni wartość
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json(); // Odbieramy zaktualizowane dane (opcjonalne)
                console.log('Dane po zmianie MyBoolVariable:', data);

                // Aktualizujemy wyświetlacz MyBoolVariable (opcjonalne)
                document.getElementById('my-bool-variable-display').textContent = data.MyBoolVariable;

            } catch (error) {
                console.error('Błąd podczas zmiany MyBoolVariable:', error);
            }
        });
    </script>
}